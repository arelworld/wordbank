<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VocabMaster - Simple Vocabulary Builder</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --secondary: #10b981;
            --bg: #f8fafc;
            --card: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text-main);
            line-height: 1.5;
        }

        .app {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .header h1 {
            font-size: 28px;
            color: var(--primary);
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header p {
            color: var(--text-muted);
            font-size: 15px;
        }

        /* Add Word Section */
        .add-word {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .input-group {
            position: relative;
        }

        .input-group input {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }

        .input-group input:focus {
            border-color: var(--primary);
        }

        .add-btn {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .add-btn:hover {
            background: var(--primary-hover);
        }

        .add-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Stats */
        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Word List */
        .word-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .word-card {
    background: var(--card);
    border-radius: 12px;
    padding: 20px;
    box-shadow: var(--shadow);
    transition: all 0.2s; /* Changed to all for border color transition */
    border: 1px solid var(--border);
}

.word-card:hover {
    transform: translateY(-2px);
    border-color: var(--primary); /* Color changes on hover */
}

        .word-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .word {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-main);
        }

        .word-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
            color: var(--text-muted);
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: var(--bg);
            color: var(--primary);
        }

        .meaning {
            margin-bottom: 16px;
            padding: 12px;
            background: #f1f5f9;
            border-radius: 8px;
            font-size: 15px;
            line-height: 1.6;
        }

        .sentence {
            margin-bottom: 16px;
            padding: 12px;
            background: #f0fdf4;
            border-radius: 8px;
            font-size: 15px;
            font-style: italic;
            line-height: 1.6;
            border-left: 3px solid var(--secondary);
        }

        .example-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
            display: block;
        }

        .date {
            font-size: 12px;
            color: var(--text-muted);
            text-align: right;
        }

        /* Search */
        .search-box {
            margin-bottom: 20px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 40px 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 15px;
            outline: none;
        }

        .search-box input:focus {
            border-color: var(--primary);
        }

        .search-icon {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .empty-state p {
            font-size: 15px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 320px;
            text-align: center;
        }

        .modal h3 {
            margin-bottom: 16px;
            color: var(--text-main);
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .modal-btn {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-cancel {
            background: var(--border);
            color: var(--text-main);
        }

        /* Responsive */
        @media (max-width: 500px) {
            .app {
                padding: 16px;
            }
            
            .word-actions {
                flex-direction: column;
            }
            
            .stats {
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <div class="header">
            <h1>VocabMaster</h1>
            <p>Build your vocabulary, one word at a time</p>
        </div>

        <!-- Add Word Section -->
        <div class="add-word">
            <div class="input-group">
                <input type="text" id="wordInput" placeholder="Type a word to add (e.g. 'eloquent')">
                <button id="addBtn" class="add-btn">Add</button>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="totalWords">0</div>
                <div class="stat-label">Words</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="todayWords">0</div>
                <div class="stat-label">Today</div>
            </div>
        </div>

        <!-- Search -->
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search words...">
            <div class="search-icon">üîç</div>
        </div>

        <!-- Word List -->
        <div id="wordList" class="word-list"></div>
    </div>

    <!-- Delete Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3>Delete this word?</h3>
            <p>It will be removed from your vocabulary list.</p>
            <div class="modal-buttons">
                <button class="modal-btn btn-cancel" onclick="closeModal()">Cancel</button>
                <button id="confirmDeleteBtn" class="modal-btn btn-danger">Delete</button>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://dpxvzxxqcwhgbngndfgc.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRweHZ6eHhxY3doZ2JuZ25kZmdjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwNjIzNjgsImV4cCI6MjA4NDYzODM2OH0.mQIeqj8zFs4oCLmKDSbTOi2pCi1DkJRGt7R0xTwBPXo';
        const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // App State
        let words = [];
        let wordToDelete = null;

        // DOM Elements
        const wordInput = document.getElementById('wordInput');
        const addBtn = document.getElementById('addBtn');
        const searchInput = document.getElementById('searchInput');
        const wordList = document.getElementById('wordList');
        const deleteModal = document.getElementById('deleteModal');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadWords();
            setupEventListeners();
        });

        // Setup Event Listeners
        function setupEventListeners() {
            // Add word
            addBtn.addEventListener('click', addWord);
            wordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addWord();
            });

            // Search
            searchInput.addEventListener('input', filterWords);

            // Delete confirmation
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);

            // Close modal on outside click
            deleteModal.addEventListener('click', (e) => {
                if (e.target === deleteModal) closeModal();
            });
        }

        // Load Words
        async function loadWords() {
            const { data, error } = await client
                .from('vocab')
                .select('*')
                .order('created_at', { ascending: false });
            
            if (error) {
                console.error('Error loading words:', error);
                return;
            }
            
            words = data || [];
            renderWords(words);
            updateStats();
        }

        // Add Word - Simple and Reliable
        async function addWord() {
            const word = wordInput.value.trim().toLowerCase();
            
            if (!word) {
                alert('Please enter a word');
                return;
            }

            // Check if word already exists
            const existing = words.find(w => w.word.toLowerCase() === word);
            if (existing) {
                alert(`"${word}" is already in your vocabulary list!`);
                return;
            }

            addBtn.disabled = true;
            addBtn.textContent = 'Adding...';

            try {
                // Get definition from Dictionary API
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                
                if (!response.ok) {
                    throw new Error('Word not found in dictionary');
                }

                const data = await response.json();
                
                // Extract definition (first one)
                const meaning = data[0]?.meanings[0]?.definitions[0]?.definition || 'No definition found';
                
                // Get example sentence from API if available
                let sentence = data[0]?.meanings[0]?.definitions[0]?.example || '';
                
                // If no example from API, create a simple one
                if (!sentence) {
                    sentence = createSimpleSentence(word);
                }

                // Clean up the sentence
                sentence = cleanSentence(sentence);

                // Add to database
                const { error } = await client
                    .from('vocab')
                    .insert([{
                        word: word.charAt(0).toUpperCase() + word.slice(1),
                        meaning: meaning,
                        sentence: sentence
                    }]);

                if (error) throw error;

                // Clear input and reload
                wordInput.value = '';
                loadWords();

            } catch (error) {
                console.error('Error:', error);
                
                // Simple fallback - let user add word manually
                const confirmAdd = confirm(`"${word}" was not found in the dictionary. Add it anyway? You can edit the definition later.`);
                
                if (confirmAdd) {
                    await client
                        .from('vocab')
                        .insert([{
                            word: word.charAt(0).toUpperCase() + word.slice(1),
                            meaning: 'Click to edit definition',
                            sentence: `Example: Using "${word}" in a sentence helps you remember it.`
                        }]);
                    
                    wordInput.value = '';
                    loadWords();
                }
            } finally {
                addBtn.disabled = false;
                addBtn.textContent = 'Add';
            }
        }

        // Create Simple Sentence
        function createSimpleSentence(word) {
            const sentences = [
                `Learning the word "${word}" expands your vocabulary.`,
                `Try using "${word}" in your daily conversations.`,
                `Understanding "${word}" improves your communication skills.`,
                `Practice using "${word}" in different contexts.`,
                `Remembering "${word}" helps in expressing yourself better.`
            ];
            
            return sentences[Math.floor(Math.random() * sentences.length)];
        }

        // Clean Sentence
        function cleanSentence(sentence) {
            // Remove extra quotes and clean up
            return sentence
                .replace(/"/g, '')
                .replace(/\[.*?\]/g, '')
                .replace(/\(.*?\)/g, '')
                .trim();
        }

        // Render Words
        function renderWords(wordArray) {
            wordList.innerHTML = '';
            
            if (!wordArray || wordArray.length === 0) {
                wordList.innerHTML = `
                    <div class="empty-state">
                        <h3>No words yet</h3>
                        <p>Add your first word to start building your vocabulary!</p>
                    </div>
                `;
                return;
            }
            
            wordArray.forEach(word => {
                const card = document.createElement('div');
                card.className = 'word-card';
                
                // Format date nicely
                const date = new Date(word.created_at);
                const formattedDate = date.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric'
                });
                
                card.innerHTML = `
                    <div class="word-header">
                        <div class="word">${word.word}</div>
                        <div class="word-actions">
                            <button class="action-btn" onclick="speakWord('${word.word}')" title="Listen">
                                üîä
                            </button>
                            <button class="action-btn" onclick="openDeleteModal('${word.id}')" title="Delete">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                    
                    <div class="meaning">
                        ${word.meaning}
                    </div>
                    
                    <div class="sentence">
                        <span class="example-label">Example</span>
                        ${word.sentence}
                    </div>
                    
                    <div class="date">
                        Added ${formattedDate}
                    </div>
                `;
                
                wordList.appendChild(card);
            });
        }

        // Filter Words
        function filterWords() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            
            if (!searchTerm) {
                renderWords(words);
                return;
            }
            
            const filtered = words.filter(word => 
                word.word.toLowerCase().includes(searchTerm) ||
                word.meaning.toLowerCase().includes(searchTerm) ||
                word.sentence.toLowerCase().includes(searchTerm)
            );
            
            renderWords(filtered);
        }

        // Update Stats
        function updateStats() {
            // Total words
            document.getElementById('totalWords').textContent = words.length;
            
            // Words added today
            const today = new Date().toDateString();
            const todayCount = words.filter(word => {
                const wordDate = new Date(word.created_at).toDateString();
                return wordDate === today;
            }).length;
            
            document.getElementById('todayWords').textContent = todayCount;
        }

        // Text-to-Speech
        function speakWord(word) {
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.rate = 0.8;
            utterance.pitch = 1;
            window.speechSynthesis.speak(utterance);
        }

        // Delete Word Modal
        function openDeleteModal(wordId) {
            wordToDelete = wordId;
            deleteModal.style.display = 'flex';
        }

        function closeModal() {
            deleteModal.style.display = 'none';
            wordToDelete = null;
        }

        async function confirmDelete() {
            if (wordToDelete) {
                await client.from('vocab').delete().eq('id', wordToDelete);
                closeModal();
                loadWords();
            }
        }

        // Edit Word (click to edit)
        async function editWord(wordId, field, newValue) {
            await client
                .from('vocab')
                .update({ [field]: newValue })
                .eq('id', wordId);
            
            loadWords();
        }

        // Make editWord available globally for inline editing
        window.editWord = editWord;
        window.speakWord = speakWord;
        window.openDeleteModal = openDeleteModal;
        window.closeModal = closeModal;
    </script>
</body>
</html>
